########################################################################
#  Test file for the experimental PRAGMA write_queue
#
#  Verifies:
#   * Default value is 1 (enabled)
#   * Setting to 0 disables and persists
#   * Setting via ON/OFF keywords works
#   * Toggle back to 0
#
#  Guarded so it silently passes if compiled without SQLITE_ENABLE_QUEUE.
########################################################################

set testdir [file dirname $argv0]
source $testdir/tester.tcl

# Skip if queue feature not compiled in.
if {![info exists ::sqlite_options(SQLITE_ENABLE_QUEUE)]} {
  finish_test
  return
}

reset_db

do_execsql_test write_queue-1.1 { PRAGMA write_queue; } {1}

do_execsql_test write_queue-1.2 {
  PRAGMA write_queue=0;
  PRAGMA write_queue;
} {0}

do_execsql_test write_queue-1.3 {
  PRAGMA write_queue=ON;
  PRAGMA write_queue;
} {1}

do_execsql_test write_queue-1.4 {
  PRAGMA write_queue=OFF;
  PRAGMA write_queue;
} {0}

do_execsql_test write_queue-1.5 {
  PRAGMA write_queue=0;
  PRAGMA write_queue;
} {0}

finish_test